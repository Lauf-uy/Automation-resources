{
  "name": "IG Comentarios (RRSS)",
  "nodes": [
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.query['hub.challenge'] }}",
        "options": {}
      },
      "id": "3a3cec80-cec5-49a2-9dd5-cf1866c296aa",
      "name": "Responder al Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -1040,
        400
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5dd13d41-1255-476a-8bb1-acb56b3e043e",
              "name": "ID Mi Instagram",
              "value": "={{ $json.body.entry[0].id }}",
              "type": "string"
            },
            {
              "id": "1a11b521-cfd8-471e-8846-1ce3bd74302f",
              "name": "ID Usuario que coment√≥",
              "value": "={{ $json.body.entry[0].changes[0].value.from.id }}",
              "type": "string"
            },
            {
              "id": "d84d76fd-5ef3-4363-b431-9f717b1192f5",
              "name": "Usuario que coment√≥",
              "value": "={{ $json.body.entry[0].changes[0].value.from.username }}",
              "type": "string"
            },
            {
              "id": "28835900-f412-4b0e-829d-6e2909fe276d",
              "name": "ID Publicaci√≥n",
              "value": "={{ $json.body.entry[0].changes[0].value.id }}",
              "type": "string"
            },
            {
              "id": "a371e454-757c-4f0e-8eae-8f3e8323d6e1",
              "name": "Comentario",
              "value": "={{ $json.body.entry[0].changes[0].value.text }}",
              "type": "string"
            },
            {
              "id": "5f6870dd-794d-4737-b6c7-9c741d2f3b36",
              "name": "Token",
              "value": "API",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "2bbf1f07-5ce0-41c8-9ae4-572d63b5311c",
      "name": "Datos Insta",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -784,
        560
      ]
    },
    {
      "parameters": {
        "content": "## Valida Webhooks",
        "height": 261.37907835618455,
        "width": 487.75568709541625,
        "color": 3
      },
      "id": "6150c5b8-b689-4322-826b-7d1920993481",
      "name": "Nota Adhesiva 1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1328,
        336
      ]
    },
    {
      "parameters": {
        "content": "## Recibe Webhooks de Comentarios",
        "height": 269.84002288146854,
        "width": 487.75568709541625,
        "color": 3
      },
      "id": "1051cf52-bab6-418a-a196-81aa7ac79bd8",
      "name": "Nota Adhesiva 2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1328,
        624
      ]
    },
    {
      "parameters": {
        "content": "## Filtrar y Procesar Comentario",
        "height": 560,
        "width": 978,
        "color": 5
      },
      "id": "f1675dce-cbd7-4d6d-97e3-9c87be73b567",
      "name": "Nota Adhesiva 3",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -816,
        336
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "87d49ac0-da56-4970-a241-836776e40b56",
              "leftValue": "={{ $json.body.object }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "e99dc50f-d3b3-463e-bc74-a3832c56467a",
              "leftValue": "={{ $json.body.entry[0].changes[0].field }}",
              "rightValue": "comments",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "fc5d9919-1ce3-4910-b5cb-83461186a754",
              "leftValue": "={{ $json.body.entry[0].changes[0].value.from.id }}",
              "rightValue": "={{ $json.body.entry[0].id }}",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "9fd90540-d0cb-4437-9808-e37c6255bd13",
      "name": "Condici√≥n Comentario",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1056,
        736
      ]
    },
    {
      "parameters": {
        "inputText": "={{ $('Datos Insta').first().json.Comentario }}",
        "categories": {
          "categories": [
            {
              "category": "Neutro",
              "description": "=Comentarios informativos, preguntas neutrales, respuestas simples, frases ambiguas, emojis sueltos que no transmiten ni cr√≠tica ni entusiasmo claro. Tambi√©n incluye comentarios que parecen autom√°ticos (sin contexto emocional), comentarios de curiosidad genuina o cualquier frase que no permita deducir una intenci√≥n claramente positiva o negativa.\n\nSituaciones que entran aqu√≠:\n\nPreguntas genuinas sin tono cr√≠tico (\"¬øD√≥nde se compra?\", \"¬øQu√© herramienta es?\", \"¬øQu√© precio tiene?\").\n\nComentarios informativos (\"Esto est√° en ingl√©s\", \"No lo he probado a√∫n\").\n\nEmojis neutros o ambiguos (ü§îüòêüëÄ).\n\nComentarios de una sola palabra sin carga emocional (\"Ok\", \"Interesante\", \"Bien\").\n\nComentarios con sarcasmo leve o ambiguo, cuando no sea claramente una cr√≠tica.\n\nRespuestas que no aportan emoci√≥n (\"S√≠\", \"No\", \"Quiz√°s\", \"Vale\")."
            },
            {
              "category": "Negativo",
              "description": "=Comentarios que expresan insatisfacci√≥n, cr√≠tica, molestia, queja, sarcasmo claro, burla, provocaci√≥n o insultos. Tambi√©n incluye iron√≠a evidente con intenci√≥n negativa, comentarios de trolls y mensajes con intenci√≥n de molestar. (\"Esto es un enga√±o\", \"No sirve para nada\").  Preguntas con tono borde o queja (\"¬øEsto es en serio? Vaya timo.\").  Comentarios de trolls (\"Jajajaja, qu√© in√∫tiles.\").  Provocaciones o insultos.  Cr√≠ticas disfrazadas de humor (\"Esto solo lo comprar√≠a un tonto üòÇ\")."
            },
            {
              "category": "Positivo",
              "description": "=Comentarios que expresan satisfacci√≥n, agrado, entusiasmo, apoyo, reconocimiento o humor simp√°tico. Tambi√©n incluye comentarios de agradecimiento, emojis positivos (‚ù§Ô∏èüî•üëèüòç), humor sano y bromas bien intencionadas.  Situaciones que entran aqu√≠:  Elogios claros al contenido o a la cuenta.  Comentarios con emojis positivos aunque no tengan texto.  Comentarios humor√≠sticos o bromas sanas que transmiten simpat√≠a.  Preguntas con tono positivo (por ejemplo: \"¬øC√≥mo puedo aprender esto? Me encanta.\").  Comentarios de agradecimiento.  Comentarios de apoyo a la marca o a la comunidad."
            }
          ]
        },
        "options": {
          "fallback": "other",
          "systemPromptTemplate": "Eres un clasificador de comentarios de Instagram. Tu √∫nica misi√≥n es retornar exactamente uno de los valores: ‚Äúpositivo‚Äù, ‚Äúnegativo‚Äù o ‚Äúneutro‚Äù.\n\nCriterios:\n1. ‚Äúpositivo‚Äù: muestra aprobaci√≥n, entusiasmo o elogios.\n2. ‚Äúnegativo‚Äù: expresa insatisfacci√≥n, cr√≠ticas o desagrado.\n3. ‚Äúneutro‚Äù: informativo, sin carga emocional o menciona palabras clave sin sentimiento.\n\nSi dudas, elige ‚Äúneutro‚Äù.\n\nEjemplos:\n- ‚ÄúMe encanta esto!‚Äù ‚Üí positivo\n- ‚ÄúEsto no sirve para nada.‚Äù ‚Üí negativo\n- ‚Äú¬øC√≥mo puedo participar?‚Äù ‚Üí neutro\n\nRetorna solo la palabra, sin m√°s texto."
        }
      },
      "id": "8e4bbd38-30d9-481b-850e-674fa1a4c174",
      "name": "Clasificador",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        -352,
        448
      ]
    },
    {
      "parameters": {
        "multipleMethods": true,
        "httpMethod": [
          "POST"
        ],
        "path": "82437302-3aed-469d-91af-a2034049a54c",
        "options": {}
      },
      "id": "bbf5051f-922e-4561-871e-1b3bdb723bb7",
      "name": "Webhook Entrada",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1296,
        736
      ],
      "webhookId": "82437302-3aed-469d-91af-a2034049a54c"
    },
    {
      "parameters": {
        "content": "## Respuesta en Instagram",
        "height": 567,
        "width": 950,
        "color": 6
      },
      "id": "b0141f70-8204-4b7d-8727-dbbd544464ff",
      "name": "Nota Adhesiva: Respuesta IG",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        192,
        320
      ]
    },
    {
      "parameters": {
        "method": "DELETE",
        "url": "=https://graph.instagram.com/v23.0/{{ $('Datos Insta').item.json['ID Publicaci√≥n'] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Datos Insta').item.json.Token }}"
            }
          ]
        },
        "options": {}
      },
      "id": "08760cc9-9d02-49a4-ba92-80875c1535ab",
      "name": "Deshabilitar Comentario",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        48,
        48
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.instagram.com/v23.0/{{ $('Datos Insta').first().json['ID Publicaci√≥n'] }}/replies",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Datos Insta').first().json.Token }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message",
              "value": "=@{{ $('Condici√≥n Comentario').item.json.body.entry[0].changes[0].value.from.username }} {{ $('Basic LLM Chain').item.json.text }}"
            }
          ]
        },
        "options": {}
      },
      "id": "134202ca-7280-4dfb-b7d8-031354fbd32a",
      "name": "Enviar Respuesta (Comentario)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        880,
        368
      ],
      "retryOnFail": true,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -32,
        736
      ],
      "id": "e33a1f32-10d0-4147-a206-a2a0323f4a45",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "blPZRDCVLVuvNnOF",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "amount": "={{ Math.floor(Math.random() * (300 - 120 + 1)) + 120 }}"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        640,
        368
      ],
      "id": "bde32c36-1e44-425e-b8e1-53b7aed4c338",
      "name": "Wait",
      "webhookId": "43b9fc22-6d7b-48c3-8655-b193b3cac849"
    },
    {
      "parameters": {
        "url": "=https://graph.instagram.com/{{ $('Condici√≥n Comentario').first().json.body.entry[0].changes[0].value.media.id }}?fields=id,caption&access_token={{ $json.Token }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -592,
        560
      ],
      "id": "1ec4d55d-6bc8-431f-a98c-61736b94c8af",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Mensaje del usuario: {{ $('Datos Insta').first().json.Comentario }}\nCapti√≥n de la publicaci√≥n: {{ $json.caption }}",
        "messages": {
          "messageValues": [
            {
              "message": "=Eres el asistente personal de Jose Espejo (@joseespejo.es), creador de la comunidad de contenido de Inteliencia aritificial(automatizaciones y agentes de IA) y tambien de PUblciidad y Funnels y fundador de EternisIA. Tu tarea es responder comentarios en Instagram de forma breve, cercana y muy humana, imitando el estilo y la energ√≠a de √Ångel.\n\nVas a recibir tambi√©n el **caption (texto de la publicaci√≥n)** como contexto adicional para entender mejor el contenido y responder con m√°s acierto a cada comentario. √ösalo para adaptar el tono, hacer referencias concretas o conectar mejor con lo que se est√° comentando.\n\n---\n\nüßæ Pautas generales:  \n‚Ä¢ Habla siempre en primera persona, como si fueras Jose.  \n‚Ä¢ Tono: cercano, entusiasta y 100% humano. Es como si respondieras a un amigo en comentarios. Nada rob√≥tico.  \n‚Ä¢ Lenguaje: informal, espa√±ol de Espa√±a. Puedes usar expresiones como ‚Äúbrutal‚Äù, ‚Äúuna locura‚Äù, ‚Äúest√° guap√≠simo‚Äù, ‚Äúesto es la ostia‚Äù, ‚Äúmola mil‚Äù, ‚Äúme flipa‚Äù, etc.  \n‚Ä¢ Risas naturales permitidas: ‚Äújajaja‚Äù, ‚Äújajajaj brutal!‚Äù, ‚Äújajaj eso es!‚Äù, etc.  \n‚Ä¢ Solo usa el signo final en exclamaciones y preguntas. Ejemplos:  \n  ‚Äì ‚ÄúEs una pasada!‚Äù  \n  ‚Äì ‚ÄúD√≥nde lo viste?‚Äù  \n  ‚Äì ‚ÄúLo tienes en mi perfil!‚Äù  \n‚Ä¢ Emojis: opcionales, m√°ximo 1 si encaja de forma natural.  \n‚Ä¢ Respuesta √∫nica por comentario. M√°ximo 1‚Äì2 frases.\n\n---\n\nüéØ Casos espec√≠ficos:\n\n1. **Comentarios positivos o de √°nimo**  \n   Responde con gratitud y emoci√≥n, un toque personal y un poco de exageraci√≥n divertida.  \n   Ejemplos:  \n   ‚Ä¢ ‚ÄúMil gracias! Me flipa que te mole!‚Äù  \n   ‚Ä¢ ‚ÄúQu√© ilusi√≥n leer esto, de verdad!‚Äù  \n   ‚Ä¢ ‚ÄúJajaja brutal que te haya gustado!‚Äù\n\n2. **Comentarios t√©cnicos o con jerga**  \n   Sin dar clases: muy breve y sin tecnicismos. Si hay inter√©s, redirige al perfil.  \n   Ejemplos:  \n   ‚Ä¢ ‚ÄúEst√° hecho en N8N, pero no necesitas ser t√©cnico eh!. Tienes el link en el perfil!‚Äù  \n   ‚Ä¢ ‚ÄúJajaj s√≠, lleva algo de IA por detr√°s! Si te mola, p√°sate por el perfil!‚Äù\n\n3. **‚Äú¬øD√≥nde puedo aprender?‚Äù, ‚Äú¬øtienes plantilla?‚Äù, ‚Äúc√≥mo lo hiciste?‚Äù**  \n   Siempre menciona el enlace en tu perfil.  \n   Ejemplos:  \n   ‚Ä¢ ‚ÄúLas plantillas y los tutoriales los subo ah√≠! Dale al link de mi perfil!‚Äù  \n   ‚Ä¢ ‚ÄúSii! Justo eso lo ense√±amos lo tengo en la link de mi perfil! √âchale un ojo!‚Äù\n\n4. **‚Äú¬øHaces automatizaciones para empresas?‚Äù, ‚Äú¬øme puedes ayudar con mi negocio?‚Äù**  \n   Redirige a tu perfil como punto de contacto, sin parecer vendedor.  \n   Ejemplos:  \n   ‚Ä¢ ‚ÄúS√≠! √âchale un vistazo a mi perfil que ah√≠ te cuento todo!‚Äù  \n   ‚Ä¢ ‚ÄúClaro! En mi perfil tienes todo lo que hacemos!‚Äù  \n   ‚Ä¢ ‚ÄúSii, nos dedicamos justo a eso! Mira mi perfil y hablamos!‚Äù\n\n5. **Comentarios gen√©ricos, emojis o ‚Äúüî•üî•‚Äù, ‚Äúqu√© locura‚Äù**  \n   Devuelve la energ√≠a con algo simple y guay.  \n   Ejemplos:  \n   ‚Ä¢ ‚ÄúEs una locura esto, eh! Jajaja‚Äù  \n   ‚Ä¢ ‚Äúüî•üî• Brutal lo que se puede hacer ahora!‚Äù  \n   ‚Ä¢ ‚ÄúMe flipa que te mole!‚Äù\n\n---\n\nüö´ Cosas que NO debes hacer:  \n‚Ä¢ No expliques procesos complejos.  \n‚Ä¢ No menciones herramientas innecesarias.  \n‚Ä¢ No parezcas un bot.  \n‚Ä¢ No mandes enlaces directos: siempre manda al perfil."
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        240,
        368
      ],
      "id": "c0d84f83-843c-4ccd-b4f5-2eb42574fac4",
      "name": "Basic LLM Chain"
    }
  ],
  "pinData": {
    "Webhook Entrada": []
  },
  "connections": {
    "Datos Insta": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Condici√≥n Comentario": {
      "main": [
        [
          {
            "node": "Datos Insta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clasificador": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Deshabilitar Comentario",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Entrada": {
      "main": [
        [
          {
            "node": "Condici√≥n Comentario",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Clasificador",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Enviar Respuesta (Comentario)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Clasificador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "5a4a9dff-e626-4697-9a2c-ee5487818045",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "b2ac49aba93e08f2f88ad135eba13a82447778c44064f81b6f1e8aafed6857d6"
  },
  "id": "NXjJZ7JGRK9J5xaQ",
  "tags": [
    {
      "createdAt": "2025-09-23T22:42:40.328Z",
      "updatedAt": "2025-09-23T22:42:40.328Z",
      "id": "vxIijfcfiQZPh8Qh",
      "name": "EternisIA"
    }
  ]
}